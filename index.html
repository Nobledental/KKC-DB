<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KCC Billing OS — Final Tax Invoice (Advanced)</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="compact_v7_5.css">

<script src="vendor/decimal.min.js"></script> 

<script src="data/tariffs.js"></script>

<script defer src="app.js"></script>

</head>
<body>
    <div class="container" id="billingPage">
        
        <div class="header-flex">
            <div class="logo-area">
                <div class="logotype">KCC</div>
                <div class="h-info">
                    <h1 class="h-title">KRISHNA KIDNEY CENTRE</h1>
                    <p class="h-sub">Krishnagiri, Tamil Nadu • India</p> 
                </div>
            </div>
            <div class="invoice-block">
                <span class="invoice-label">DISCHARGE FINAL **TAX** BILL</span>
                <p class="small-meta">Bill No: <strong id="b_invoice_no">PROVISIONAL</strong></p>
                <p class="small-meta">Run Date: <strong id="b_run_date">-</strong></p>
            </div>
        </div>

        <div class="compact-line"> 
            <button onclick="generateNewIDs()" class="btn-compact print-btn" style="background: #e38d13;">Generate New IDs</button>
            <button onclick="newBill()" class="btn-compact delete-btn">Clear Bill</button>
        </div>


        <div class="section">
            <div class="column-title">Patient & General Details</div>
            <div class="details-grid" id="patientInputGrid">
                
                <div> <label>UHID (6 DIGIT)</label> <input type="text" id="ui_uhid" placeholder="UHID (6 Digit)" value="000007" oninput="updatePatientDetails()"></div>
                <div> <label>IP No (6 DIGIT)</label> <input type="text" id="ui_ip" placeholder="IP No (6 Digit)" value="000007" oninput="updatePatientDetails()"></div>
                <div> <label>Patient Name</label> <input type="text" id="ui_name" placeholder="Name" value="Mr. RAHUL" oninput="updatePatientDetails()"></div>
                
                <div> <label>Age</label> <input type="number" id="ui_age" placeholder="Age" value="55" oninput="updatePatientDetails()"></div>
                <div> <label>Gender</label> <select id="ui_gender" onchange="updatePatientDetails()"><option>Male</option><option>Female</option></select></div>
                <div> <label>Room Category</label> <select id="ui_roomCat" onchange="updatePatientDetails()"></select></div>

                <div> <label>Admission Date</label> <input type="date" id="ui_doa" value="2025-11-28" oninput="updatePatientDetails()"></div>
                <div> <label>Discharge Date</label> <input type="date" id="ui_dod" value="2025-11-30" oninput="updatePatientDetails()"></div>
                <div> <label>Consultant</label> <select id="ui_doc" onchange="updatePatientDetails()"></select> </div>

                <div> <label>Speciality</label> <input type="text" id="ui_spec" value="Urology" oninput="updatePatientDetails()"> </div>
                <div> <label>Insurance</label> <input type="text" id="ui_insurance" value="Self Pay" oninput="updatePatientDetails()"> </div>
                <div style="grid-column: span 3; text-align: right;">
                    <button onclick="addRoomDays()" class="btn-compact primary-btn">Auto-Charge Room/Nursing</button>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="column-title">Billing Items</div>
            <div class="column-header-row" id="billHeaderRow"> 
                <div class="column-header">S.No</div>
                <div class="column-header">Date</div>
                <div class="column-header" style="text-align: left;">Description</div>
                <div class="column-header financial-header">Rate</div>
                <div class="column-header">Qty</div>
                <div class="column-header financial-header">Gross</div>
                <div class="column-header financial-header">Discount</div>
                <div class="column-header financial-header">Net (Taxable)</div>
                <div class="column-header financial-header">Tax Amt</div>
                <div class="column-header financial-header">Total</div>
                <div class="column-header">Action</div>
            </div>
            <div class="column-detail" id="ui_billBody">
                </div>
            <div style="text-align: right; margin-top: 10px;">
                 <button onclick="clearBillingItems()" class="btn-compact delete-btn">Clear All Items</button>
            </div>
        </div>

        <div class="section add-item-section">
            <div class="column-title" style="margin-top: 0; background: #fff; padding: 0;">Add Item Manually</div>
             <div class="details-grid" style="padding: 10px 0; grid-template-columns: 1.5fr 1.5fr 1fr 1fr 0.5fr;">
                <div> <label>Category</label> <select id="ui_cat"></select> </div>
                <div> <label>Description/Package</label> <select id="ui_desc"></select> </div>
                <div> <label>Rate (Auto/Manual)</label> <input type="number" id="ui_rate"> </div>
                <div> <label>Qty</label> <input type="number" id="ui_qty" value="1"> </div>
                <div> <label>Action</label> <button onclick="addItem()" class="btn-compact full add-btn">Add</button> </div>
            </div>
        </div>
        
        <div class="section">
            <div class="column-title">Receipts and Payments</div>
            <div class="summary-box">
                <div id="receiptLines">
                    </div>
                
                <div style="margin-top: 10px; border-top: 1px solid #eee; padding-top: 5px;">
                    <label style="display: inline;">Receipt No:</label>
                    <input type="text" id="ui_rno" style="width: 100px;">
                    <input type="number" id="ui_ramt" placeholder="Amount" style="width: 100px;">
                    <input type="date" id="ui_rdate" style="width: 120px;">
                    <select id="ui_rmode" style="width: 80px;"><option>Cash</option><option>UPI</option></select>
                    <button onclick="addReceipt()" class="btn-compact primary-btn">Add Payment</button>
                </div>
            </div>
        </div>


        <div class="section">
            <div class="column-title">Summary</div>
            <div class="summary-box summary-grid">
                
                <div class="sum-line summary-row">
                    <span>Global Bill Discount (%)</span> 
                    <input type="number" id="ui_billDiscount" value="0" min="0" max="100" oninput="updatePatientDetails()">
                </div>
                
                <div class="sum-line summary-row">
                    <span>Total Gross</span> <strong id="ui_s_gross">₹0.00</strong>
                </div>
                
                <div class="sum-line summary-row sub-total-line">
                    <span>Total Item Discount</span> <strong id="ui_itemDiscount">- ₹0.00</strong>
                </div>
                
                <div class="sum-line summary-row sub-total-line">
                    <span>Global Discount Applied</span> <strong id="ui_globalDiscount">- ₹0.00</strong>
                </div>
                
                <div class="sum-line summary-row total total-taxable">
                    <span>Taxable Amount (Pre-Tax)</span> <strong id="ui_s_net_bill">₹0.00</strong>
                </div>
                
                <div class="sum-line summary-row tax-line">
                    <span>GST/VAT Rate (<span id="ui_tax_rate">0</span>%)</span> <strong id="ui_s_tax_rate">₹0.00</strong>
                </div>
                
                <div class="sum-line summary-row total">
                    <span>**GRAND TOTAL** (Tax Incl.)</span> <strong id="ui_s_grand_total">₹0.00</strong>
                </div>
                
                <div class="sum-line summary-row receipt-line">
                    <span>Receipts Paid</span> <strong id="ui_s_rec">₹0.00</strong>
                </div>
                
                <div class="sum-line summary-row final-balance">
                    <span>BALANCE DUE</span> <strong id="ui_s_final">₹0.00</strong>
                </div>
                
                <div class="print-action">
                    <button onclick="preparePrint()" class="btn-compact print-btn full">Export Final PDF</button>
                </div>
            </div>
        </div>

    </div>
</body>
</html>
