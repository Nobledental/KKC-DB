<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>KCC Billing OS — Final Tax Invoice</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link rel="stylesheet" href="compact_v7_5.css">

<script>
/* *** DECIMAL.JS LIBRARY CODE GOES HERE ***
    To run this offline, replace this comment block with the FULL minified code 
    from decimal.min.js (or ensure it's loaded via <script src="vendor/decimal.min.js"></script>
    if using a vendor folder).
*/
if (typeof Decimal === 'undefined') {
    // Basic fallback for development testing only
    console.error("Decimal.js not loaded. Financial calculations will be inaccurate.");
    // Define a dummy Decimal to prevent hard crash during development
    window.Decimal = function(value) {
        return {
            toNumber: () => Number(value),
            plus: (other) => new Decimal(Number(value) + Number(other)),
            mul: (other) => new Decimal(Number(value) * Number(other)),
            toFixed: (d) => Number(value).toFixed(d),
            lte: (other) => Number(value) <= Number(other),
            gt: (other) => Number(value) > Number(other),
            lt: (other) => Number(value) < Number(other),
            div: (other) => new Decimal(Number(value) / Number(other)),
            minus: (other) => new Decimal(Number(value) - Number(other))
        };
    };
}
</script>

<script src="data/tariffs.js"></script>

<script defer src="app.js"></script>

</head>
<body>
    <div class="container" id="billingPage">
        
        <div class="header-flex">
            <div class="logo-area">
                <div class="logotype">KCC</div>
                <div class="h-info">
                    <h1 class="h-title">KRISHNA KIDNEY CENTRE</h1>
                    <p class="h-sub">Krishnagiri, Tamil Nadu • India</p> 
                </div>
            </div>
            <div class="invoice-block">
                <span class="invoice-label">IP TAX INVOICE — CASH</span>
                <p class="small-meta">Bill No: <strong id="b_invoice_no">PROVISIONAL</strong></p>
                <p class="small-meta">Run Date: <strong id="b_run_date">-</strong></p>
            </div>
        </div>

        <div class="compact-line"> 
            <input type="text" id="ui_uhid" placeholder="UHID" value="KCC001045"> &nbsp;•&nbsp; 
            <input type="text" id="ui_ip" placeholder="IP No" value="KCC-IPD-0045"> &nbsp;•&nbsp; 
            Age: <input type="number" id="ui_age" placeholder="Age" value="55" style="width: 40px;"> / <select id="ui_gender" style="width: 70px;"><option>Male</option><option>Female</option></select> &nbsp;•&nbsp; 
            Room: <select id="ui_roomCat" style="width: 120px;"></select>
            <button onclick="addRoomDays()" class="btn-compact">Auto-Charge</button>
            <button onclick="preparePrint()" class="btn-compact print-btn">Export PDF</button>
        </div>

        <div class="section">
            <div class="column-title">Patient & Billing Details</div>
            <div class="details-grid">
                <div> 
                    <label>Patient Name</label> 
                    <input type="text" id="ui_name" placeholder="Name" value="Mr. RAHUL">
                </div>
                <div> 
                    <label>Admission Date</label> 
                    <input type="date" id="ui_doa" value="2025-11-28">
                </div>
                <div> 
                    <label>Discharge Date</label> 
                    <input type="date" id="ui_dod" value="2025-11-30">
                </div>
                <div> 
                    <label>Practitioner</label> 
                    <select id="ui_doc"></select>
                </div>
                <div> 
                    <label>Speciality</label> 
                    <input type="text" id="ui_spec" value="Urology">
                </div>
                <div> 
                    <label>Discount (%)</label> 
                    <input type="number" id="ui_billDiscount" placeholder="0" value="0">
                </div>
                <div> 
                    <label>Bill Item Category</label> 
                    <select id="ui_cat">
                        <option value="Consultation">Consultation</option>
                        <option value="Pharmacy">Pharmacy</option>
                        <option value="Investigation">Investigation</option>
                        <option value="Package">Package</option>
                        <option value="Miscellaneous">Miscellaneous</option>
                        <option value="Returns">Returns</option>
                    </select>
                </div>
                <div> 
                    <label>Item Description / Rate</label> 
                    <select id="ui_desc"></select>
                </div>
                <div> 
                    <label>Qty / Add Item</label> 
                    <input type="number" id="ui_qty" value="1" style="width: 40px;">
                    <button onclick="addItem()" class="btn-compact">Add</button>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="column-title">Billing Items</div>
            <div class="column-header-row">
                <div class="column-header">Category</div>
                <div class="column-header">Date</div>
                <div class="column-header">Description</div>
                <div class="column-header">Rate</div>
                <div class="column-header">Qty</div>
                <div class="column-header">Gross</div>
                <div class="column-header">Net</div>
                <div class="column-header">Action</div>
            </div>
            <div class="column-detail" id="ui_billBody">
                </div>
        </div>

        <div class="section">
            <div class="column-title">Summary</div>
            <div class="summary-box">
                <div class="sum-line"><span>Total Gross</span> <strong id="ui_s_gross">₹0.00</strong></div>
                <div class="sum-line"><span>Total Discount</span> <strong id="ui_totalDiscount">- ₹0.00</strong></div>
                <div class="sum-line"><span>Taxable Amount</span> <strong id="ui_s_net_bill">₹0.00</strong></div>
                <div class="sum-line total"><span>Final Amount Payable</span> <strong id="ui_s_final">₹0.00</strong></div>
                
                <div class="sum-line" style="margin-top: 10px;"><span>Receipts Paid</span> <strong id="ui_s_rec">₹0.00</strong></div>
                <input type="number" id="ui_ramt" placeholder="Add Receipt Amt" style="width: 100px;">
                <select id="ui_rmode" style="width: 80px;"><option>Cash</option><option>UPI</option></select>
                <button onclick="addReceipt()" class="btn-compact">Pay</button>
            </div>
        </div>
    </div>
</body>
</html>
